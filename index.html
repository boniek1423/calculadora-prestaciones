<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Laboral Pro - Venezuela</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    
    <style>
        :root { --primary-blue: #00247d; --ven-yellow: #ffcc00; --ven-red: #cf142b; }
        body { background-color: #f0f2f5; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .card { border: none; border-radius: 15px; box-shadow: 0 8px 24px rgba(0,0,0,0.12); }
        .card-header { background: var(--primary-blue); color: white; border-radius: 15px 15px 0 0 !important; }
        .section-title { color: var(--primary-blue); font-weight: bold; border-left: 4px solid var(--ven-yellow); padding-left: 10px; margin-bottom: 20px; margin-top: 10px; }
        .res-box { background: white; border-radius: 12px; padding: 25px; border-top: 4px solid var(--primary-blue); }
        .total-highlight { font-size: 1.8rem; color: #198754; font-weight: 800; }
        .total-bs { font-size: 1.3rem; color: #0d6efd; font-weight: 700; }
        .pdf-btn { background: var(--ven-red); color: white; border: none; font-weight: bold; padding: 12px 30px; }
        .pdf-btn:hover { background: #a51022; color: white; transform: scale(1.02); }
    </style>
</head>
<body>

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-header text-center p-4">
                    <h2 class="mb-0">Sistema de Liquidaci칩n LOTTT</h2>
                    <p class="mb-0 opacity-75">C치lculo Integral con Al칤cuotas, Tasa BCV y Deducciones</p>
                </div>
                <div class="card-body p-4">
                    <form id="liquidacionForm">
                        <div class="row g-4">
                            <div class="col-md-3">
                                <h6 class="section-title">1. Salarios y Tasa</h6>
                                <div class="mb-3">
                                    <label class="form-label small fw-bold">Sueldo Mensual ($)</label>
                                    <input type="number" id="sueldo" class="form-control form-control-lg" placeholder="0.00" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label small fw-bold text-primary">Tasa BCV (Bs/$)</label>
                                    <input type="number" id="tasaBCV" class="form-control" placeholder="Ej: 36.50" step="0.01">
                                </div>
                                <div class="row">
                                    <div class="col-6">
                                        <label class="form-label small">Utilidades (D칤as)</label>
                                        <input type="number" id="diasUtil" class="form-control" value="30">
                                    </div>
                                    <div class="col-6">
                                        <label class="form-label small">Bono Vac. (D칤as)</label>
                                        <input type="number" id="diasVac" class="form-control" value="15">
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-3 border-start">
                                <h6 class="section-title">2. Relaci칩n Laboral</h6>
                                <div class="mb-3">
                                    <label class="form-label small fw-bold">Fecha Ingreso</label>
                                    <input type="date" id="fIngreso" class="form-control" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label small fw-bold">Fecha Egreso</label>
                                    <input type="date" id="fEgreso" class="form-control" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label small fw-bold">Motivo</label>
                                    <select id="motivo" class="form-select">
                                        <option value="renuncia">Renuncia Voluntaria</option>
                                        <option value="despido">Despido Injustificado (Art. 92)</option>
                                    </select>
                                </div>
                            </div>

                            <div class="col-md-3 border-start">
                                <h6 class="section-title">3. Otros Haberes</h6>
                                <div class="mb-3">
                                    <label class="form-label small fw-bold">Feriados/Dom. Trab. (Cant.)</label>
                                    <input type="number" id="extras_input" class="form-control" value="0">
                                    <small class="text-muted">No pagados anteriormente</small>
                                </div>
                            </div>

                            <div class="col-md-3 border-start">
                                <h6 class="section-title text-danger">4. Deducciones ($)</h6>
                                <div class="mb-3">
                                    <label class="form-label small fw-bold">Anticipos Prestaciones</label>
                                    <input type="number" id="anticipos" class="form-control" value="0">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label small fw-bold">Pr칠stamos/Deudas</label>
                                    <input type="number" id="prestamos" class="form-control" value="0">
                                </div>
                            </div>
                        </div>

                        <div class="text-center mt-5">
                            <button type="button" onclick="calcularTodo()" class="btn btn-primary btn-lg px-5 rounded-pill shadow">
                                Calcular Liquidaci칩n
                            </button>
                        </div>
                    </form>

                    <div id="seccionResultados" class="mt-5 d-none">
                        <div class="res-box shadow-sm">
                            <div class="row align-items-center">
                                <div class="col-md-7">
                                    <table class="table table-hover table-sm">
                                        <tr><td>Tiempo de Servicio:</td><td class="text-end fw-bold" id="outTiempo"></td></tr>
                                        <tr><td>Sueldo Integral Diario:</td><td class="text-end fw-bold" id="outIntegral"></td></tr>
                                        <tr><td>Antig칲edad (Garant칤a):</td><td class="text-end fw-bold" id="outPrest"></td></tr>
                                        <tr><td>Fraccionados (Util/Vac):</td><td class="text-end fw-bold" id="outFrac"></td></tr>
                                        <tr><td>Deducciones Totales:</td><td class="text-end fw-bold text-danger" id="outDed"></td></tr>
                                    </table>
                                </div>
                                <div class="col-md-5 text-center border-start">
                                    <p class="text-muted mb-0 fw-bold">NETO A RECIBIR EN DIVISAS</p>
                                    <div class="total-highlight mb-2" id="outTotalUSD"></div>
                                    <p class="text-muted mb-0 fw-bold">EQUIVALENTE EN BOL칈VARES</p>
                                    <div class="total-bs" id="outTotalBS"></div>
                                </div>
                            </div>
                        </div>
                        <div class="text-center mt-4">
                            <button onclick="generarPDF()" class="btn pdf-btn btn-lg rounded-pill shadow">
                                游늯 Generar Reporte PDF Oficial
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
let data = {};

function calcularTodo() {
    const vals = {
        sueldo: parseFloat(document.getElementById('sueldo').value),
        tasa: parseFloat(document.getElementById('tasaBCV').value) || 1,
        dUtil: parseFloat(document.getElementById('diasUtil').value),
        dVac: parseFloat(document.getElementById('diasVac').value),
        fIng: new Date(document.getElementById('fIngreso').value),
        fEgr: new Date(document.getElementById('fEgreso').value),
        motivo: document.getElementById('motivo').value,
        extras: parseInt(document.getElementById('extras_input').value) || 0,
        anticipos: parseFloat(document.getElementById('anticipos').value) || 0,
        prestamos: parseFloat(document.getElementById('prestamos').value) || 0
    };

    if (!vals.sueldo || isNaN(vals.fIng) || isNaN(vals.fEgr)) {
        alert("Complete sueldo y fechas obligatorias"); return;
    }

    // 1. Salario Integral
    const dBase = vals.sueldo / 30;
    const sIntegral = dBase + (dBase * vals.dUtil / 360) + (dBase * vals.dVac / 360);

    // 2. Tiempo y D칤as (Art 142)
    let a침os = vals.fEgr.getFullYear() - vals.fIng.getFullYear();
    let meses = vals.fEgr.getMonth() - vals.fIng.getMonth();
    if (vals.fEgr.getDate() < vals.fIng.getDate()) meses--;
    if (meses < 0) { a침os--; meses += 12; }

    const dAntiguedad = (a침os * 60) + (meses * 5);
    const dAdic = a침os >= 1 ? Math.min(a침os * 2, 30) : 0;
    const mPrestaciones = (dAntiguedad + dAdic) * sIntegral;

    // 3. Fraccionados
    const mesesFrac = meses; 
    const mUtilFrac = (mesesFrac * (vals.dUtil / 12)) * dBase;
    const dVacAnu = Math.min(15 + a침os, 30);
    const mVacFrac = (mesesFrac * (dVacAnu / 12)) * dBase;
    const mBonoVacFrac = (mesesFrac * (vals.dVac / 12)) * dBase;

    // 4. Indemnizaci칩n y Otros
    const mIndem = (vals.motivo === 'despido') ? mPrestaciones : 0;
    const mExtras = vals.extras * (dBase * 1.5);

    // 5. Totales
    const totalBruto = mPrestaciones + mUtilFrac + mVacFrac + mBonoVacFrac + mIndem + mExtras;
    const totalDed = vals.anticipos + vals.prestamos;
    const netoUSD = totalBruto - totalDed;

    data = {
        fReporte: new Date().toLocaleDateString('es-VE'),
        tiempo: `${a침os} a침os, ${meses} meses`,
        sIntegral: sIntegral,
        mPrest: mPrestaciones,
        mFrac: mUtilFrac + mVacFrac + mBonoVacFrac,
        mIndem: mIndem,
        mExtras: mExtras,
        mDeducciones: totalDed,
        netoUSD: netoUSD,
        netoBS: netoUSD * vals.tasa,
        tasa: vals.tasa,
        motivo: vals.motivo === 'despido' ? 'Despido Injustificado' : 'Renuncia Voluntaria',
        sueldoBase: vals.sueldo
    };

    mostrarResultados();
}

function mostrarResultados() {
    document.getElementById('seccionResultados').classList.remove('d-none');
    document.getElementById('outTiempo').innerText = data.tiempo;
    document.getElementById('outIntegral').innerText = data.sIntegral.toFixed(2) + " $";
    document.getElementById('outPrest').innerText = data.mPrest.toLocaleString('es-VE') + " $";
    document.getElementById('outFrac').innerText = data.mFrac.toLocaleString('es-VE') + " $";
    document.getElementById('outDed').innerText = "- " + data.mDeducciones.toLocaleString('es-VE') + " $";
    document.getElementById('outTotalUSD').innerText = data.netoUSD.toLocaleString('es-VE', {minimumFractionDigits: 2}) + " $";
    document.getElementById('outTotalBS').innerText = data.netoBS.toLocaleString('es-VE', {minimumFractionDigits: 2}) + " Bs.";
    document.getElementById('seccionResultados').scrollIntoView({behavior: 'smooth'});
}

function generarPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    
    doc.setFillColor(0, 36, 125);
    doc.rect(0, 0, 210, 35, 'F');
    doc.setTextColor(255, 255, 255);
    doc.setFontSize(18);
    doc.text("LIQUIDACI칍N DE HABERES LABORALES", 105, 22, { align: "center" });

    doc.setTextColor(40, 40, 40);
    doc.setFontSize(10);
    doc.text(`Fecha Emisi칩n: ${data.fReporte}`, 15, 45);
    doc.text(`Tiempo de Servicio: ${data.tiempo}`, 15, 50);
    doc.text(`Tasa de Cambio: ${data.tasa.toFixed(2)} Bs/$`, 15, 55);
    doc.text(`Causa de Egreso: ${data.motivo}`, 15, 60);

    const tableBody = [
        ["Salario Base Mensual", `${data.sueldoBase.toFixed(2)} $`],
        ["Salario Integral Diario", `${data.sIntegral.toFixed(2)} $`],
        ["Garant칤a de Prestaciones (Art. 142)", `${data.mPrest.toFixed(2)} $`],
        ["Al칤cuotas Fraccionadas (Util/Vac)", `${data.mFrac.toFixed(2)} $`]
    ];

    if(data.mExtras > 0) tableBody.push(["Extras (Feriados/Dom)", `${data.mExtras.toFixed(2)} $`]);
    if(data.mIndem > 0) tableBody.push(["Indemnizaci칩n Art. 92", `${data.mIndem.toFixed(2)} $`]);
    if(data.mDeducciones > 0) tableBody.push(["Deducciones Totales", `-${data.mDeducciones.toFixed(2)} $`]);

    doc.autoTable({
        startY: 70,
        head: [['Concepto', 'Monto ($)']],
        body: tableBody,
        theme: 'striped',
        headStyles: { fillColor: [0, 36, 125] }
    });

    let finalY = doc.lastAutoTable.finalY + 15;
    doc.setFillColor(230, 230, 230);
    doc.rect(120, finalY, 75, 25, 'F');
    doc.setFont("helvetica", "bold");
    doc.text("NETO A PAGAR ($):", 125, finalY + 10);
    doc.text(`${data.netoUSD.toLocaleString('es-VE')} $`, 190, finalY + 18, {align: 'right'});

    doc.text("NETO A PAGAR (Bs.):", 125, finalY + 35);
    doc.text(`${data.netoBS.toLocaleString('es-VE')} Bs.`, 190, finalY + 43, {align: 'right'});

    doc.save(`Liquidacion_${data.fReporte}.pdf`);
}
</script>
</body>
</html>
